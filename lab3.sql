USE master;
DROP DATABASE IF EXISTS SocialNetwork;
CREATE DATABASE SocialNetwork;
USE SocialNetwork;

-- Создание таблицы Одногруппники
CREATE TABLE Одногруппники (
    Id INT PRIMARY KEY IDENTITY,
    Имя NVARCHAR(50),
    Фамилия NVARCHAR(50),
    Группа NVARCHAR(10),
    Курс INT,
    Возраст INT,
    Пол NVARCHAR(1)
);

-- Создание таблицы Книги
CREATE TABLE Книги (
    Id INT PRIMARY KEY IDENTITY,
    Название NVARCHAR(100),
    Автор NVARCHAR(100),
    Жанр NVARCHAR(50)
);

-- Создание таблицы Фильмы
CREATE TABLE Фильмы (
    Id INT PRIMARY KEY IDENTITY,
    Название NVARCHAR(100),
    Режиссер NVARCHAR(100),
    Жанр NVARCHAR(50)
);

-- Создание таблицы РекомендуетКнигу
CREATE TABLE РекомендуетКнигу (
    Id INT PRIMARY KEY IDENTITY,
    ОдногруппникId INT,
    КнигаId INT,
    FOREIGN KEY (ОдногруппникId) REFERENCES Одногруппники(Id),
    FOREIGN KEY (КнигаId) REFERENCES Книги(Id)
);

-- Создание таблицы РекомендуетФильм
CREATE TABLE РекомендуетФильм (
    Id INT PRIMARY KEY IDENTITY,
    ОдногруппникId INT,
    ФильмId INT,
    FOREIGN KEY (ОдногруппникId) REFERENCES Одногруппники(Id),
    FOREIGN KEY (ФильмId) REFERENCES Фильмы(Id)
);


-- Вставка данных в таблицу Одногруппники
INSERT INTO Одногруппники (Имя, Фамилия, Группа, Курс, Возраст, Пол)
VALUES 
('Мария', 'Петрова', 'БИ-201', 2, 19, 'Ж'),
('Иван', 'Иванов', 'БИ-201', 2, 20, 'М'),
('Анна', 'Сидорова', 'БИ-201', 2, 19, 'Ж'),
('Алексей', 'Кузнецов', 'БИ-201', 2, 21, 'М'),
('Елена', 'Смирнова', 'БИ-201', 2, 20, 'Ж'),
('Дмитрий', 'Волков', 'БИ-201', 2, 22, 'М'),
('Ольга', 'Михайлова', 'БИ-201', 2, 19, 'Ж'),
('Никита', 'Фёдоров', 'БИ-201', 2, 20, 'М'),
('Светлана', 'Николаева', 'БИ-201', 2, 21, 'Ж'),
('Андрей', 'Крылов', 'БИ-201', 2, 22, 'М');

-- Вставка данных в таблицу Книги
INSERT INTO Книги (Название, Автор, Жанр)
VALUES 
('Война и мир', 'Толстой', 'Исторический роман'),
('Преступление и наказание', 'Достоевский', 'Психологический роман'),
('Мастер и Маргарита', 'Булгаков', 'Фантастика'),
('Анна Каренина', 'Толстой', 'Роман'),
('Идиот', 'Достоевский', 'Психологический роман'),
('Тихий Дон', 'Шолохов', 'Исторический роман'),
('Отцы и дети', 'Тургенев', 'Роман'),
('Доктор Живаго', 'Пастернак', 'Роман'),
('Герой нашего времени', 'Лермонтов', 'Роман'),
('Обломов', 'Гончаров', 'Роман');

-- Вставка данных в таблицу Фильмы
INSERT INTO Фильмы (Название, Режиссер, Жанр)
VALUES 
('Интерстеллар', 'Кристофер Нолан', 'Научная фантастика'),
('Начало', 'Кристофер Нолан', 'Научная фантастика'),
('Матрица', 'Лана Вачовски, Лилли Вачовски', 'Научная фантастика'),
('Аватар', 'Джеймс Кэмерон', 'Научная фантастика'),
('Терминатор 2', 'Джеймс Кэмерон', 'Боевик'),
('Бегущий по лезвию', 'Ридли Скотт', 'Научная фантастика'),
('Назад в будущее', 'Роберт Земекис', 'Фантастика'),
('Звёздные войны: Эпизод IV', 'Джордж Лукас', 'Фантастика'),
('Гравитация', 'Альфонсо Куарон', 'Научная фантастика'),
('Пятый элемент', 'Люк Бессон', 'Научная фантастика');

-- Вставка данных в таблицу РекомендуетКнигу
INSERT INTO РекомендуетКнигу (ОдногруппникId, КнигаId)
VALUES 
((SELECT Id FROM Одногруппники WHERE Имя = 'Мария'), (SELECT Id FROM Книги WHERE Название = 'Война и мир')),
((SELECT Id FROM Одногруппники WHERE Имя = 'Иван'), (SELECT Id FROM К

SELECT o.Имя, o.Фамилия
FROM Одногруппники o
JOIN РекомендуетКнигу rk ON o.Id = rk.ОдногруппникId
JOIN Книги k ON rk.КнигаId = k.Id
WHERE k.Название = 'Война и мир';


SELECT k.Название, k.Автор
FROM Одногруппники o
JOIN РекомендуетКнигу rk ON o.Id = rk.ОдногруппникId
JOIN Книги k ON rk.КнигаId = k.Id
WHERE o.Имя = 'Мария' AND o.Фамилия = 'Петрова';


SELECT o.Имя, o.Фамилия, f.Название
FROM Одногруппники o
JOIN РекомендуетФильм rf ON o.Id = rf.ОдногруппникId
JOIN Фильмы f ON rf.ФильмId = f.Id;


SELECT DISTINCT o.Имя, o.Фамилия
FROM Одногруппники o
JOIN РекомендуетКнигу rk ON o.Id = rk.ОдногруппникId
JOIN РекомендуетФильм rf ON o.Id = rf.ОдногруппникId;


SELECT o.Имя, o.Фамилия, f.Название
FROM Одногруппники o
JOIN РекомендуетФильм rf ON o.Id = rf.ОдногруппникId
JOIN Фильмы f ON rf.ФильмId = f.Id
WHERE f.Жанр = 'Научная фантастика';
